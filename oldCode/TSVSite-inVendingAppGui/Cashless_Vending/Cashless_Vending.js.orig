'use strict';

angular.module('myApp.Cashless_Vending', ['ngRoute'])

    .config(['$routeProvider', function($routeProvider) {
        $routeProvider.when('/Cashless_Vending', {
            templateUrl: 'Cashless_Vending/Cashless_Vending.html',
            controller: 'Cashless_VendingCtrl'
        });
    }])

    .controller('Cashless_VendingCtrl', ['$scope', '$rootScope','$timeout', '$location', 'TSVService', function($scope, $rootScope, $timeout, $location, TSVService) {
        TSVService.debug("Cashless vending...");
        $rootScope.credit = TSVService.session.creditBalance;
        TSVService.session.currentView = "Cashless_Vending";
        $timeout.cancel(TSVService.session.generalIdleTimer);

        $scope.item = TSVService.cache.shoppingCart.detail[0];
        $scope.summary = TSVService.cache.shoppingCart.summary;

<<<<<<< HEAD
        TSVService.killGeneralIdleTimer();

        $scope.cardTransactionResponse = "Vending...";
        $scope.showCancelBtn = false;
=======
>>>>>>> 04d324d592d25aa64b03d8bde8317e9a133c0616
        TSVService.loadingSpinner();
        TSVService.startVend();
        TSVService.session.bVendingInProcess = true;

        //TSVService.session.cardMsg = "Vending...";

        var vendResponseHandler = function(processStatus){
            TSVService.vendResponse(processStatus, $location);
        };

        TSVService.subscribe("vendResponse", $scope, vendResponseHandler);

        $scope.$on('$destroy', function() {
            TSVService.unsubscribe("vendResponse", $scope, vendResponseHandler)
        });
    }]);
'use strict';

angular.module('myApp.view2', ['ngRoute'])

.config(['$routeProvider', function($routeProvider) {
  $routeProvider.when('/view2', {
    templateUrl: 'view2/view2.html',
    controller: 'View2Ctrl'
  });
}])

.controller('View2Ctrl', ['$scope', '$rootScope', '$timeout','$location', 'TSVService', function($scope, $rootScope, $timeout, $location, TSVService, $modal, Idle) {
    TSVService.session.currentView = "view2";
    TSVService.enablePaymentDevice("PAYMENT_TYPE_CREDIT_CARD");
    TSVService.enablePaymentDevice("PAYMENT_TYPE_CASH");
    TSVService.cache.shoppingCart = TSVService.fetchShoppingCart2();
    TSVService.session.cardMsg = "Please Swipe Card...";
    TSVService.session.cashMsg = "Please Insert Money...";
    $scope.item = TSVService.cache.shoppingCart.detail[0];
    $scope.imagePath = $scope.item.imagePath;
    $scope.imagePath2 = $scope.imagePath;
    $scope.summary = TSVService.cache.shoppingCart.summary;

    $rootScope.credit = TSVService.session.creditBalance;
    $scope.nutritionFactsUrl = "";
    $scope.bShowNutritionFactsBtn = false;
    $scope.bShowCalories = false;
    $scope.calories = "0 Cal";
    $scope.bShowDesc = false;

    if($scope.item.description == ""){
        $scope.bShowDesc = false;
    }

    //Not finished...
    if($scope.item.Attributes != undefined && $scope.item.Attributes != null){
        var objNutritionFactImage = $scope.item.Attributes.NutritionalFactsImages;
        var nutritionFactFlag = (objNutritionFactImage != undefined && objNutritionFactImage != null)? true:false;

        if(nutritionFactFlag){
            console.log("NutritionFactImageURL: "+objNutritionFactImage[0]);
            $scope.nutritionFactsUrl = "../Images/Products/"+$scope.item.productID+"_"+objNutritionFactImage[0];
            $scope.bShowNutritionFactsBtn = true;
            $scope.imagePath2 = $scope.nutritionFactsUrl;
        }

        if($scope.item.Attributes.Calories != undefined && $scope.item.Attributes.Calories != null){
            $scope.bShowCalories = true;
            $scope.calories = $scope.item.Attributes.Calories[0] + " Cal";
        }
    }

    $(document).ready(function() {
<<<<<<< HEAD
        if(typeof $.fancybox !== "undefined"){
            $(".fancyboxNutrition0").fancybox({
                openEffect	: 'none',
                closeEffect	: 'none',
                closeClick  : true,
                helpers   : {
                    overlay : {closeClick: true}
                }
            });

            $(".fancyboxNutrition1").fancybox({
                openEffect	: 'none',
                closeEffect	: 'none',
                closeClick  : true
            });
            $(".fancyboxNutrition2").fancybox({
                openEffect	: 'none',
                closeEffect	: 'none',
                closeClick  : true
            });
        }
=======
        $(".fancyboxNutrition0").fancybox({
            openEffect	: 'none',
            closeEffect	: 'none',
            closeClick  : true,
            helpers   : {
                overlay : {
                    css : { 'overflow' : 'hidden' }
                }
            }
        });

        $(".fancyboxNutrition1").fancybox({
            openEffect	: 'none',
            closeEffect	: 'none',
            closeClick  : true,
            helpers   : {
                overlay : {
                    css : { 'overflow' : 'hidden' }
                }
            }
        });
        $(".fancyboxNutrition2").fancybox({
            openEffect	: 'none',
            closeEffect	: 'none',
            closeClick  : true,
            helpers   : {
                overlay : {
                    css : { 'overflow' : 'hidden' }
                }
            }
        });
>>>>>>> 6625c3222e617b4c72280d6736535d4703d6b559
    });

    $scope.back = function() {
        TSVService.emptyCart();
        $location.path("/view1");
    }

    $scope.checkout = function() {
        $location.path("/Cash_Card");
    }

    var cardTransactionHandler = function(level) {
        console.log("Got event cardTransactionResponse()default: "+level);
        $.fancybox.close();

        if(!TSVService.session.bVendingInProcess) {
            if($location.path() != "/Card_Vending"){
                //console.log("change path to Card_Vending");
                $location.path("/Card_Vending");
            }
            TSVService.cardTransaction(level);
        }
    };

    TSVService.subscribe("cardTransactionResponse", $scope, cardTransactionHandler);

    $scope.$on('$destroy', function() {
        TSVService.unsubscribe("cardTransactionResponse", $scope, cardTransactionHandler)
    });
}]);